{% extends 'partials/base.html.twig' %}

{% block content %}
{# Chargement des données #}
{% include 'partials/skn/flex-loader.html.twig' %}

<div class="skn-page skn-explore">
    {# Header #}
    <header class="skn-page__header">
        <div class="skn-container">
            <div>
                <h1><i class="la la-compass"></i> Explorer</h1>
                <p class="skn-text-muted">Découvrez toutes les rooms de la communauté</p>
            </div>
            {% if is_logged_in %}
                <a href="/create-room" class="skn-btn skn-btn--primary">
                    <i class="la la-plus"></i> Créer une room
                </a>
            {% endif %}
        </div>
    </header>

    <div class="skn-container">
        {# Filtres #}
        <div class="skn-filters">
            <div class="skn-tabs">
                <button class="skn-tab skn-tab--active" data-filter="all">
                    Toutes ({{ rooms_count }})
                </button>
                <button class="skn-tab" data-filter="public">
                    <i class="la la-globe"></i> Publiques
                </button>
                <button class="skn-tab" data-filter="private">
                    <i class="la la-lock"></i> Privées
                </button>
            </div>
            
            <div class="skn-search">
                <i class="la la-search"></i>
                <input type="text" 
                       id="search-rooms" 
                       class="skn-input" 
                       placeholder="Rechercher une room..." />
            </div>
        </div>

        {# Liste des rooms #}
        <section class="skn-section">
            {% if rooms_count > 0 %}
                <div id="rooms-grid" class="skn-card-list skn-card-list--grid skn-card-list--col-3">
                    {% for room in rooms %}
                        <div class="skn-room-wrapper" 
                             data-name="{{ room.name|lower }}" 
                             data-access="{{ room.access_level|default('public') }}">
                            {% include 'partials/skn/room-card.html.twig' with {
                                room: room,
                                current_user: current_user,
                                variant: 'default'
                            } only %}
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="skn-empty-state">
                    <div class="skn-empty-state__icon">
                        <i class="la la-layer-group"></i>
                    </div>
                    <h3>Aucune room pour le moment</h3>
                    <p>Soyez le premier à créer une room !</p>
                    {% if is_logged_in %}
                        <a href="/create-room" class="skn-btn skn-btn--primary">
                            <i class="la la-plus"></i> Créer une room
                        </a>
                    {% else %}
                        <a href="/register" class="skn-btn skn-btn--primary">
                            <i class="la la-user-plus"></i> Rejoindre la communauté
                        </a>
                    {% endif %}
                </div>
            {% endif %}
        </section>

        {# Section membres #}
        <section class="skn-section">
            <div class="skn-section__header">
                <h2><i class="la la-users"></i> Membres de la communauté</h2>
                <span class="skn-badge">{{ users_count }}</span>
            </div>

            {% if accounts %}
                <div class="skn-card-list skn-card-list--grid skn-card-list--col-4">
                    {% for user in accounts %}
                        {% include 'partials/skn/card.html.twig' with {
                            title: user.fullname|default(user.username),
                            subtitle: '@' ~ user.username,
                            avatar: (user.fullname|default(user.username))|first|upper,
                            link: '/u/' ~ user.username,
                            stats: [
                                {icon: 'layer-group', value: user.relations.spaces|default([])|length, label: 'Rooms'}
                            ],
                            variant: 'compact',
                            clickable: true
                        } only %}
                    {% endfor %}
                </div>
            {% else %}
                <div class="skn-empty-state skn-empty-state--sm">
                    <p>Aucun membre pour le moment</p>
                </div>
            {% endif %}
        </section>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Filtres
    const tabs = document.querySelectorAll('.skn-tab[data-filter]');
    const rooms = document.querySelectorAll('.skn-room-wrapper');
    
    tabs.forEach(tab => {
        tab.addEventListener('click', function() {
            const filter = this.dataset.filter;
            
            tabs.forEach(t => t.classList.remove('skn-tab--active'));
            this.classList.add('skn-tab--active');
            
            rooms.forEach(room => {
                if (filter === 'all' || room.dataset.access === filter) {
                    room.style.display = '';
                } else {
                    room.style.display = 'none';
                }
            });
        });
    });
    
    // Recherche
    const searchInput = document.getElementById('search-rooms');
    if (searchInput) {
        searchInput.addEventListener('input', function() {
            const query = this.value.toLowerCase();
            rooms.forEach(room => {
                if (room.dataset.name.includes(query)) {
                    room.style.display = '';
                } else {
                    room.style.display = 'none';
                }
            });
        });
    }
});
</script>
{% endblock %}
